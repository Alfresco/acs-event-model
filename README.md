## Alfresco Content Services Event Model
[![Build Status](https://travis-ci.com/Alfresco/acs-event-model.svg?branch=master)](https://travis-ci.com/Alfresco/acs-event-model)

Alfresco Content Services Event Model is a library packaged as a jar file which is part of [Alfresco Content Services Repository](https://community.alfresco.com/docs/DOC-6385-project-overview-repository).
The library contains the events models and databind helpers to help the clients to marshall and unmarshall the events.

### Event Object

| Property             | Type          | Description                                                      |
|----------------------|---------------|------------------------------------------------------------------|
|`type`                |String         |The Alfresco event type. ([1.0 spec#type](https://github.com/cloudevents/spec/blob/v1.0/spec.md#type))|
|`specversion`         |String         |The CloudEvents specification version. Value should be '1.0'. ([1.0 spec#specversion](https://github.com/cloudevents/spec/blob/v1.0/spec.md#specversion))|
|`id`                  |String         |Event ID, a UUID generated by the producer ([1.0 spec#id](https://github.com/cloudevents/spec/blob/v1.0/spec.md#id))|
|`source`              |URI-reference  |The instance of a repository that produced the event, .i.e. repository cluster node identifier ([1.0 spec#source](https://github.com/cloudevents/spec/blob/v1.0/spec.md#source))|
|`time`                |Timestamp      |The producer's timestamp of when the event occurred. ([1.0 spec#time](https://github.com/cloudevents/spec/blob/v1.0/spec.md#time))|
|`dataschema`          |URI-reference  |Identifies the schema that data adheres to |
|`datacontenttype`     |String         |The content type of the data attribute. Value should be 'application/json'. ([1.0 spec#datacontenttype](https://github.com/cloudevents/spec/blob/v1.0/spec.md#datacontenttype))|
|`data`                |JSON           |The domain-specific data of the event. ([1.0 spec#data](https://github.com/cloudevents/spec/blob/v1.0/spec.md#data-attribute))|
|`data.eventGroupId`   |String         |Optional unique identifier for events group, i.e. a transaction ID         |
|`data.resource`       |Object (varies)|The object representing the resource affected|
|`data.resourceBefore` |Object (varies)|The object representing the old values of the changed resource's attributes. Note, this object is only available on the `Updated` event type|


### Resource Object

| Property                        | Type          | Description                                                      |
|---------------------------------|---------------|------------------------------------------------------------------|
|`data.resource.id`               |String         |The unique ID of the resource, i.e. a node ID|
|`data.resource.primaryHierarchy` |Array          |Optional primary hierarchy of ancestors of the resource affected, i.e. folder path for content. Note that the first element is the immediate parent|

The rest of resource object attributes are self explanatory. See [JSON Schema](#json-schema) for the detailed view of the attributes' types.

### Event Types

| Name                              | Description                                                      |
|-----------------------------------|------------------------------------------------------------------|
| `org.alfresco.event.node.Created` | Occurs when a node is created |
| `org.alfresco.event.node.Updated` | Occurs when a node is updated. Currently only node's name, properties, aspects, and content are supported|
| `org.alfresco.event.node.Deleted` | Occurs when a node is deleted |


### JSON Schema

For a detailed view of the event content refer to [Repo Event JSON schema](src/main/resources/json-schema/RepoEvent.json).

### File created event example

```json
{
  "specversion": "1.0",
  "type": "org.alfresco.event.node.Created",
  "id": "97c1b36c-c569-4c66-8a31-7a8d0b6b804a",
  "source": "/f6d21231-618e-4f12-a920-e498660c5b9d",
  "time": "2020-04-27T12:37:03.560134+01:00",
  "dataschema": "urn:jsonschema:org:alfresco:repo:event:v1:model:EventData",
  "datacontenttype": "application/json",
  "data": {
    "eventGroupId": "cb645043-e7d2-4e51-b61d-e6d01582cbab",
    "resource": {
      "id": "7491120a-e2cb-478f-8599-ebf057cc0c7c",
      "name": "testFile.txt",
      "nodeType": "cm:content",
      "isFolder": false,
      "isFile": true,
      "createdByUser": {
        "id": "john.doe",
        "displayName": "John Doe"
      },
      "createdAt": "2020-04-27T12:37:03.555624+01:00",
      "modifiedByUser": {
        "id": "jane.doe",
        "displayName": "Jane Doe"
      },
      "modifiedAt": "2020-04-27T12:37:03.557956+01:00",
      "content": {
        "mimeType": "text/plain",
        "sizeInBytes": 16,
        "encoding": "UTF-8"
      },
      "primaryHierarchy": [
        "521aac1c-20eb-444b-a137-2da3d35ee1a8",
        "2641bbe1-39ff-44dc-b47f-736552ad46cc"
      ],
      "properties": {
        "cm:title": "test title"
      },
      "aspectNames": [
        "cm:titled",
        "cm:auditable"
      ]
    }
  }
}
```

## Building and testing

The project can be built and tested by running the following Maven command:
~~~
mvn clean install
~~~

### Artifacts
The artifact can be obtained by:
* downloading from [Alfresco repository](https://artifacts.alfresco.com/nexus/content/groups/public)
* getting as Maven dependency by adding the dependency to your pom file:
~~~
<dependency>
  <groupId>org.alfresco</groupId>
  <artifactId>acs-event-model</artifactId>
  <version>version</version>
</dependency>
~~~
and Alfresco repository:
~~~
<repository>
  <id>alfresco-maven-repo</id>
  <url>https://artifacts.alfresco.com/nexus/content/groups/public</url>
</repository>
~~~
**Note:**
The SNAPSHOT version of the artifact is **never** published.

## Clients

For unmarshalling the JSON result to RepoEvent object, Java clients can you use the following factory to get the ObjectMapper configured with the RepoEvent format:

```java
ObjectMapper mapper = ObjectMapperFactory.createInstance();

RepoEvent<NodeResource> result = mapper.readValue(jsonString, new TypeReference<>()
{
});
```

### Contributing guide
Please use [this guide](CONTRIBUTING.md) to make a contribution to the project.

